<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Satisfaction Portal</title>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="logo">JobSatisfy</div>
  <ul class="nav-links">
    <li><a href="#home">Home</a></li>
    <li><a href="#survey">Survey</a></li>
    <li><a href="#footer">Contact</a></li>
  </ul>
</nav>

<!-- Home Section -->
<section id="home" class="home">
  <h1>Welcome to the Job Satisfaction Portal</h1>
  <p>Your voice matters! Please take a few moments to complete the survey and help improve your workplace.</p>
</section>

<!-- Survey Form Section -->
<section id="survey" class="survey">
  <form id="surveyForm">
    <h2>Employee Survey</h2>

    <label for="name">Full Name</label>
    <input type="text" name="name" id="name" placeholder="Your Name" required />

    <label for="email">Email</label>
    <input type="email" name="email" id="email" placeholder="Your Email" required />

    <label for="q1">1. How satisfied are you with your current job role?</label>
    <select name="q1" id="q1" required>
      <option value="">Select</option>
      <option>Very Satisfied</option>
      <option>Satisfied</option>
      <option>Neutral</option>
      <option>Dissatisfied</option>
      <option>Very Dissatisfied</option>
    </select>

    <label for="q2">2. Do you feel valued and recognized for your work?</label>
    <select name="q2" id="q2" required>
      <option value="">Select</option>
      <option>Always</option>
      <option>Often</option>
      <option>Sometimes</option>
      <option>Rarely</option>
      <option>Never</option>
    </select>

    <label for="q3">3. How would you rate your work-life balance?</label>
    <select name="q3" id="q3" required>
      <option value="">Select</option>
      <option>Excellent</option>
      <option>Good</option>
      <option>Average</option>
      <option>Poor</option>
    </select>

    <label for="q4">4. How clear are your job responsibilities and expectations?</label>
    <select name="q4" id="q4" required>
      <option value="">Select</option>
      <option>Very Clear</option>
      <option>Somewhat Clear</option>
      <option>Unclear</option>
    </select>

    <label for="q5">5. How satisfied are you with your manager's support?</label>
    <select name="q5" id="q5" required>
      <option value="">Select</option>
      <option>Very Satisfied</option>
      <option>Satisfied</option>
      <option>Neutral</option>
      <option>Dissatisfied</option>
      <option>Very Dissatisfied</option>
    </select>

    <label for="q6">6. Do you see opportunities for growth in this organization?</label>
    <select name="q6" id="q6" required>
      <option value="">Select</option>
      <option>Definitely</option>
      <option>Possibly</option>
      <option>Not Sure</option>
      <option>Not Really</option>
      <option>No</option>
    </select>

    <label for="q7">7. Would you recommend this company to a friend?</label>
    <select name="q7" id="q7" required>
      <option value="">Select</option>
      <option>Yes</option>
      <option>Maybe</option>
      <option>No</option>
    </select>

    <label for="comments">Additional Comments or Suggestions</label>
    <textarea name="comments" id="comments" rows="4" placeholder="Your feedback..."></textarea>

    <button type="submit">Submit Survey</button>
    <p id="responseMsg"></p>
  </form>
</section>

<!-- Admin Pie Charts Section -->
<section id="admin" style="padding: 60px 40px;">
  <h2 style="color: #1e3a8a; margin-bottom: 20px;">ðŸ“Š Survey Results</h2>

  <button onclick="downloadExcel()" style="margin-bottom: 30px; padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer;">
    ðŸ“¥ Download Excel
  </button>

<div id="chart-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
  <div class="chart-container"><canvas id="q1Chart"></canvas></div>
  <div class="chart-container"><canvas id="q2Chart"></canvas></div>
  <div class="chart-container"><canvas id="q3Chart"></canvas></div>
  <div class="chart-container"><canvas id="q4Chart"></canvas></div>
  <div class="chart-container"><canvas id="q5Chart"></canvas></div>
  <div class="chart-container"><canvas id="q6Chart"></canvas></div>
  <div class="chart-container"><canvas id="q7Chart"></canvas></div>
</div>

<!-- Footer -->
<footer id="footer" class="footer">
  <p>&copy; 2025 JobSatisfy | Built for Employee Wellness</p>
</footer>

<!-- Script to Load Pie Charts -->
<script>
  async function loadAllCharts() {
    try {
      const res = await fetch("http://localhost:3000/all-chart-data");
      const data = await res.json();

      Object.keys(data).forEach((question) => {
        const labels = data[question].map(item => item.answer);
        const counts = data[question].map(item => item.count);
        const ctx = document.getElementById(`${question}Chart`).getContext("2d");

        new Chart(ctx, {
          type: "pie",
          data: {
            labels,
            datasets: [{
              label: question.toUpperCase(),
              data: counts,
              backgroundColor: [
                "#3b82f6", "#10b981", "#facc15", "#f97316", "#ef4444", "#8b5cf6", "#06b6d4"
              ],
            }],
          },
        options: {
  responsive: false, // â›” Prevent auto-resize by Chart.js
  maintainAspectRatio: true,
  plugins: {
    title: {
      display: true,
      text: `${question.toUpperCase()} Responses`,
      font: {
        size: 14,
        weight: 'bold'
      }
    },
    legend: {
      position: 'bottom',
      labels: {
        boxWidth: 10,
        font: {
          size: 10
        }
      }
    }
  },
  layout: {
    padding: 0
  }
}
        });
      });
    } catch (error) {
      console.error("Error loading chart data:", error);
    }
  }

  function downloadExcel() {
    window.location.href = "http://localhost:3000/download-excel";
  }

  window.onload = function () {
    loadAllCharts();
  };
</script>

<script src="../Javascript/script.js"></script>
</body>
</html>
